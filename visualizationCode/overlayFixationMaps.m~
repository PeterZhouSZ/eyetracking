load('../allImages.mat');

thresh = 0.1;
scaleFact = 4; % a larger number speeds up computation
gausPar = 32/scaleFact; % this is a parameter, can change sigma

whichfix = 'enc'; % or 'rec'
whichim = 1;
whichusers = [3,4,5]; 
% uncomment the following line to use all users:
whichusers = 1:length(allImages(whichim).userdata); 

%%
im = imread(allImages(whichim).impath);
imsize = [size(im,1),size(im,2)];
maxsize = max(imsize(1),imsize(2));

allfix = [];
for j = 1:length(whichusers)
    
    whichuser = whichusers(j);
    
    if isempty(allImages(whichim).userdata(whichuser).fixations) || ...
            ~isfield(allImages(whichim).userdata(whichuser).fixations,whichfix) || ...
            isempty(allImages(whichim).userdata(whichuser).fixations.(whichfix))
        continue;
    end
    
    fixdata = allImages(whichim).userdata(whichuser).fixations.(whichfix);
    allfix = [allfix ; fixdata];

end
    
%% plot fixation heatmap
    
    map = makeMap(allfix,imsize(1),imsize(2),scaleFact);
    map = map/max(map(:));
     
    figure; imshow(heatmap_overlay(im,map,'hot')); title('Fixation Heatmap');

%% plot coverage map

    figure; imshow(map>thresh); title('Coverage');

    im_new = im;
    map = imresize(map,imsize);

    for ii = 1:size(im_new,3)
       temp = im_new(:,:,ii);
       temp(map<=thresh) = 0;
       im_new(:,:,ii) = temp;
    end

    figure; imshow(im_new); title('Overlayed coverage');

     